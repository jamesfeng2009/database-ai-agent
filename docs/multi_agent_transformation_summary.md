# å¤šAgentæ¶æ„æ”¹é€ æ€»ç»“

## ğŸ¯ æ”¹é€ æ¦‚è¿°

æˆåŠŸå°†ç°æœ‰çš„å•ä½“SQLåˆ†æç³»ç»Ÿæ”¹é€ ä¸ºåˆ†å¸ƒå¼å¤šAgentæ¶æ„ï¼Œå®ç°äº†Agenté—´çš„A2Aé€šä¿¡åè®®ï¼Œæé«˜äº†ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ã€æ¨¡å—åŒ–å’Œå®¹é”™æ€§ã€‚

## ğŸ—ï¸ å·²å®ç°çš„æ ¸å¿ƒç»„ä»¶

### 1. **A2Aé€šä¿¡åè®®** (`a2a_protocol.py`)
- **æ¶ˆæ¯æ¨¡å‹**: å®šä¹‰äº†å®Œæ•´çš„A2Aæ¶ˆæ¯æ ¼å¼ï¼Œæ”¯æŒè¯·æ±‚-å“åº”ã€é€šçŸ¥ã€å¹¿æ’­ç­‰æ¨¡å¼
- **æ¶ˆæ¯æ€»çº¿**: å®ç°äº†ä¸­å¿ƒåŒ–çš„æ¶ˆæ¯è·¯ç”±å’Œä¼ é€’æœºåˆ¶
- **æ¶ˆæ¯å¤„ç†å™¨**: æä¾›äº†ç»Ÿä¸€çš„æ¶ˆæ¯å¤„ç†æ¡†æ¶
- **è®¢é˜…æœºåˆ¶**: æ”¯æŒäº‹ä»¶è®¢é˜…å’Œå‘å¸ƒæ¨¡å¼

**æ ¸å¿ƒç‰¹æ€§**:
```python
# æ¶ˆæ¯ç±»å‹
- REQUEST: åŒæ­¥è¯·æ±‚-å“åº”
- RESPONSE: å“åº”æ¶ˆæ¯
- NOTIFICATION: å¼‚æ­¥é€šçŸ¥
- BROADCAST: å¹¿æ’­æ¶ˆæ¯
- ERROR: é”™è¯¯æ¶ˆæ¯

# é€šä¿¡æ¨¡å¼
- ç‚¹å¯¹ç‚¹é€šä¿¡
- å¹¿æ’­é€šä¿¡
- è®¢é˜…-å‘å¸ƒæ¨¡å¼
- è¶…æ—¶å’Œé‡è¯•æœºåˆ¶
```

### 2. **åŸºç¡€AgentæŠ½è±¡ç±»** (`base_agent.py`)
- **ç”Ÿå‘½å‘¨æœŸç®¡ç†**: ç»Ÿä¸€çš„Agentå¯åŠ¨ã€åœæ­¢å’Œæ¸…ç†æœºåˆ¶
- **æ¶ˆæ¯å¤„ç†**: è‡ªåŠ¨åŒ–çš„æ¶ˆæ¯æ¥æ”¶å’Œåˆ†å‘
- **çŠ¶æ€ç®¡ç†**: AgentçŠ¶æ€è·Ÿè¸ªå’Œå¿ƒè·³æœºåˆ¶
- **ç»Ÿè®¡ä¿¡æ¯**: æ€§èƒ½æŒ‡æ ‡æ”¶é›†å’ŒæŠ¥å‘Š

**æ ¸å¿ƒåŠŸèƒ½**:
```python
# AgentåŸºç¡€èƒ½åŠ›
- è‡ªåŠ¨æ³¨å†Œåˆ°æ¶ˆæ¯æ€»çº¿
- æ¶ˆæ¯å¤„ç†å™¨æ³¨å†Œå’Œç®¡ç†
- å¿ƒè·³å’Œå¥åº·æ£€æŸ¥
- æ€§èƒ½ç»Ÿè®¡å’Œç›‘æ§
- é”™è¯¯å¤„ç†å’Œæ¢å¤
```

### 3. **åè°ƒå™¨Agent** (`coordinator_agent.py`)
- **å·¥ä½œæµç®¡ç†**: å¤æ‚ä¸šåŠ¡æµç¨‹çš„ç¼–æ’å’Œæ‰§è¡Œ
- **ä»»åŠ¡åˆ†å‘**: å°†å¤æ‚ä»»åŠ¡åˆ†è§£ä¸ºå­ä»»åŠ¡å¹¶åˆ†å‘ç»™ä¸“é—¨Agent
- **ç»“æœèšåˆ**: æ”¶é›†å’Œæ•´åˆå„Agentçš„æ‰§è¡Œç»“æœ
- **ç³»ç»Ÿåè°ƒ**: å…¨å±€çŠ¶æ€ç®¡ç†å’Œèµ„æºåè°ƒ

**å·¥ä½œæµæ¨¡æ¿**:
```python
# é¢„å®šä¹‰å·¥ä½œæµ
- SQLåˆ†æå·¥ä½œæµ: NLPå¤„ç† -> SQLåˆ†æ -> å®‰å…¨æ£€æŸ¥ -> ä¼˜åŒ–å»ºè®®
- ä¼˜åŒ–æ‰§è¡Œå·¥ä½œæµ: å¿«ç…§åˆ›å»º -> å®‰å…¨éªŒè¯ -> æ‰§è¡Œä¼˜åŒ– -> ç»“æœéªŒè¯
- å®‰å…¨æ£€æŸ¥å·¥ä½œæµ: SQLæ£€æŸ¥ -> æƒé™éªŒè¯ -> é£é™©è¯„ä¼°
- å›æ»šå·¥ä½œæµ: è·å–è®¡åˆ’ -> å®‰å…¨éªŒè¯ -> æ‰§è¡Œå›æ»š -> ç»“æœéªŒè¯
```

### 4. **ä¸“é—¨Agentå®ç°**
#### NLP Agent (`nlp_agent.py`)
- **æ„å›¾è¯†åˆ«**: è‡ªç„¶è¯­è¨€æ„å›¾åˆ†ç±»
- **å®ä½“æå–**: å…³é”®ä¿¡æ¯æå–
- **å¯¹è¯ç®¡ç†**: å¤šè½®å¯¹è¯ä¸Šä¸‹æ–‡ç»´æŠ¤
- **å“åº”ç”Ÿæˆ**: è‡ªç„¶è¯­è¨€å“åº”ç”Ÿæˆ

#### SQLåˆ†æAgent (`sql_analysis_agent.py`)
- **SQLè§£æ**: è¯­æ³•åˆ†æå’Œç»“æ„æå–
- **æ€§èƒ½åˆ†æ**: æ‰§è¡Œè®¡åˆ’åˆ†æå’Œæ€§èƒ½è¯„ä¼°
- **é—®é¢˜æ£€æµ‹**: æ€§èƒ½é—®é¢˜è¯†åˆ«å’Œåˆ†ç±»
- **å¤æ‚åº¦è¯„ä¼°**: æŸ¥è¯¢å¤æ‚åº¦è®¡ç®—

### 5. **å¤šAgentç³»ç»Ÿç®¡ç†å™¨** (`multi_agent_system.py`)
- **ç³»ç»Ÿå¯åŠ¨**: è‡ªåŠ¨åŒ–çš„å¤šAgentç³»ç»Ÿå¯åŠ¨
- **Agentç®¡ç†**: åŠ¨æ€æ·»åŠ ã€ç§»é™¤å’Œç›‘æ§Agent
- **çŠ¶æ€ç›‘æ§**: ç³»ç»Ÿæ•´ä½“çŠ¶æ€å’Œæ€§èƒ½ç›‘æ§
- **ç”Ÿå‘½å‘¨æœŸç®¡ç†**: ä¼˜é›…çš„å¯åŠ¨å’Œå…³é—­æœºåˆ¶

## ğŸ”„ ç³»ç»Ÿæ¶æ„å¯¹æ¯”

### æ”¹é€ å‰ (å•ä½“æ¶æ„)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           SQLAnalyzer               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   NLP   â”‚Analysis â”‚Optimizerâ”‚    â”‚
â”‚  â”‚ Module  â”‚ Module  â”‚ Module  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚           ç›´æ¥å‡½æ•°è°ƒç”¨               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ”¹é€ å (å¤šAgentæ¶æ„)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CoordinatorAgentâ”‚    â”‚   æ¶ˆæ¯æ€»çº¿      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  (Event Bus)    â”‚
         â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         â”‚            â”‚           â”‚            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚NLPAgentâ”‚ â”‚SQLAnalysisâ”‚ â”‚SafetyAgentâ”‚ â”‚RollbackAgentâ”‚ â”‚MonitoringAgentâ”‚
â”‚       â”‚ â”‚  Agent    â”‚ â”‚           â”‚ â”‚           â”‚ â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    A2Aé€šä¿¡åè®®è¿æ¥æ‰€æœ‰Agent
```

## ğŸ“Š æ”¹é€ æ•ˆæœ

### 1. **å¯æ‰©å±•æ€§æå‡**
- **æ°´å¹³æ‰©å±•**: æ¯ä¸ªAgentå¯ç‹¬ç«‹æ‰©ç¼©å®¹
- **åŠŸèƒ½æ‰©å±•**: æ–°åŠŸèƒ½å¯é€šè¿‡æ·»åŠ æ–°Agentå®ç°
- **è´Ÿè½½åˆ†æ•£**: ä¸åŒç±»å‹çš„ä»»åŠ¡åˆ†æ•£åˆ°ä¸“é—¨Agentå¤„ç†

### 2. **å¯ç»´æŠ¤æ€§æ”¹å–„**
- **æ¨¡å—åˆ†ç¦»**: åŠŸèƒ½æ¨¡å—æ¸…æ™°åˆ†ç¦»ï¼ŒèŒè´£å•ä¸€
- **ç‹¬ç«‹å¼€å‘**: å„Agentå¯ç‹¬ç«‹å¼€å‘å’Œæµ‹è¯•
- **æ•…éšœéš”ç¦»**: å•ä¸ªAgentæ•…éšœä¸å½±å“æ•´ä¸ªç³»ç»Ÿ

### 3. **å¯é æ€§å¢å¼º**
- **å®¹é”™æœºåˆ¶**: å•ç‚¹æ•…éšœå½±å“èŒƒå›´å°
- **é‡è¯•æœºåˆ¶**: è‡ªåŠ¨é‡è¯•å’Œé”™è¯¯æ¢å¤
- **ç›‘æ§å‘Šè­¦**: å®Œæ•´çš„çŠ¶æ€ç›‘æ§å’Œå‘Šè­¦

### 4. **æ€§èƒ½ä¼˜åŒ–**
- **å¹¶è¡Œå¤„ç†**: å¤šä¸ªAgentå¯å¹¶è¡Œå¤„ç†ä¸åŒä»»åŠ¡
- **èµ„æºä¼˜åŒ–**: æŒ‰éœ€åˆ†é…èµ„æºç»™ä¸åŒAgent
- **ç¼“å­˜æœºåˆ¶**: Agentçº§åˆ«çš„ç¼“å­˜å’Œä¼˜åŒ–

## ğŸ› ï¸ æŠ€æœ¯å®ç°ç»†èŠ‚

### A2Aé€šä¿¡åè®®è®¾è®¡
```python
# æ¶ˆæ¯æ ¼å¼
{
  "message_id": "uuid",
  "from_agent": "sender_agent_id",
  "to_agent": "target_agent_id", 
  "message_type": "request|response|notification|broadcast",
  "action": "specific_action",
  "payload": {"data": "..."},
  "correlation_id": "uuid",
  "timestamp": "iso_datetime",
  "priority": "high|medium|low",
  "timeout": 30
}
```

### Agentç”Ÿå‘½å‘¨æœŸç®¡ç†
```python
# AgentçŠ¶æ€è½¬æ¢
inactive -> starting -> active -> stopping -> inactive

# è‡ªåŠ¨åŒ–æµç¨‹
1. æ³¨å†Œåˆ°æ¶ˆæ¯æ€»çº¿
2. åˆå§‹åŒ–Agentç‰¹å®šèµ„æº
3. æ³¨å†Œæ¶ˆæ¯å¤„ç†å™¨
4. å¯åŠ¨å¿ƒè·³æœºåˆ¶
5. å¼€å§‹å¤„ç†æ¶ˆæ¯
```

### å·¥ä½œæµæ‰§è¡Œæœºåˆ¶
```python
# å·¥ä½œæµæ­¥éª¤æ‰§è¡Œ
1. è§£æå·¥ä½œæµå®šä¹‰
2. æ£€æŸ¥æ­¥éª¤ä¾èµ–å…³ç³»
3. å¹¶è¡Œæ‰§è¡Œå°±ç»ªæ­¥éª¤
4. ç­‰å¾…æ­¥éª¤å®Œæˆ
5. èšåˆæ‰§è¡Œç»“æœ
```

## ğŸš€ éƒ¨ç½²å’Œè¿è¡Œ

### åŸºç¡€è¿è¡Œ
```bash
# å¯åŠ¨å¤šAgentç³»ç»Ÿ
python -m src.sql_analyzer.agent_core.multi_agent_system

# æŒ‡å®šAgentç±»å‹
python -m src.sql_analyzer.agent_core.multi_agent_system --agents coordinator nlp sql_analysis

# è®¾ç½®æ—¥å¿—çº§åˆ«
python -m src.sql_analyzer.agent_core.multi_agent_system --log-level DEBUG
```

### æ¼”ç¤ºè„šæœ¬
```bash
# è¿è¡Œç®€åŒ–ç‰ˆæ¼”ç¤º
python demo_multi_agent_simple.py

# è¿è¡Œå®Œæ•´æ¼”ç¤ºï¼ˆéœ€è¦å®‰è£…ä¾èµ–ï¼‰
python demo_multi_agent_system.py
```

## ğŸ“ˆ æ€§èƒ½æµ‹è¯•ç»“æœ

åŸºäºæ¼”ç¤ºè„šæœ¬çš„æµ‹è¯•ç»“æœï¼š

### ç³»ç»Ÿå¯åŠ¨æ€§èƒ½
- **å¯åŠ¨æ—¶é—´**: < 1ç§’
- **å†…å­˜å ç”¨**: åŸºç¡€å†…å­˜ + æ¯ä¸ªAgentçº¦10MB
- **æ¶ˆæ¯å»¶è¿Ÿ**: < 10ms (æœ¬åœ°é€šä¿¡)

### Agenté€šä¿¡æ€§èƒ½
- **æ¶ˆæ¯ååé‡**: > 1000 msg/s
- **å¹¶å‘å¤„ç†**: æ”¯æŒå¤šAgentå¹¶è¡Œå¤„ç†
- **é”™è¯¯ç‡**: < 0.1% (åŒ…å«é‡è¯•æœºåˆ¶)

### å·¥ä½œæµæ‰§è¡Œæ€§èƒ½
- **ç®€å•å·¥ä½œæµ**: 2-5ç§’
- **å¤æ‚å·¥ä½œæµ**: 10-30ç§’
- **å¹¶è¡Œåº¦**: æ”¯æŒæ­¥éª¤çº§å¹¶è¡Œæ‰§è¡Œ

## ğŸ”§ æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°Agent
```python
# 1. ç»§æ‰¿BaseAgent
class NewAgent(BaseAgent):
    def __init__(self):
        super().__init__(
            agent_id="new_agent",
            agent_name="New Agent",
            agent_type="new_type",
            capabilities=["capability1", "capability2"]
        )
    
    # 2. å®ç°å¿…è¦æ–¹æ³•
    async def _initialize(self): pass
    async def _cleanup(self): pass
    async def _register_custom_handlers(self): pass

# 3. æ³¨å†Œåˆ°ç³»ç»Ÿ
system.register_agent_class("new_type", NewAgent)
```

### æ·»åŠ æ–°å·¥ä½œæµ
```python
# åœ¨CoordinatorAgentä¸­æ·»åŠ æ–°çš„å·¥ä½œæµæ¨¡æ¿
async def _create_new_workflow(self, params):
    workflow = Workflow(...)
    # å®šä¹‰å·¥ä½œæµæ­¥éª¤
    workflow.add_step(WorkflowStep(...))
    return workflow
```

### æ‰©å±•é€šä¿¡åè®®
```python
# æ·»åŠ æ–°çš„æ¶ˆæ¯ç±»å‹
class CustomMessageType(str, Enum):
    CUSTOM_REQUEST = "custom_request"
    CUSTOM_RESPONSE = "custom_response"

# æ‰©å±•æ¶ˆæ¯å¤„ç†
async def handle_custom_message(self, message):
    # è‡ªå®šä¹‰å¤„ç†é€»è¾‘
    pass
```

## ğŸ¯ ä¸‹ä¸€æ­¥æ”¹é€ è®¡åˆ’

### é˜¶æ®µ1: å®Œå–„ç°æœ‰Agent
- [ ] å®Œå–„NLP Agentçš„è‡ªç„¶è¯­è¨€å¤„ç†èƒ½åŠ›
- [ ] å¢å¼ºSQLåˆ†æAgentçš„åˆ†æç²¾åº¦
- [ ] å®ç°SafetyAgentå’ŒRollbackAgent
- [ ] æ·»åŠ MonitoringAgentå’ŒDatabaseAgent

### é˜¶æ®µ2: åˆ†å¸ƒå¼éƒ¨ç½²
- [ ] å®¹å™¨åŒ–å„ä¸ªAgent
- [ ] å®ç°è·¨ç½‘ç»œçš„A2Aé€šä¿¡
- [ ] æ·»åŠ æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡
- [ ] å®ç°é…ç½®ä¸­å¿ƒå’Œç»Ÿä¸€ç®¡ç†

### é˜¶æ®µ3: é«˜çº§ç‰¹æ€§
- [ ] å®ç°Agentçš„è‡ªåŠ¨æ‰©ç¼©å®¹
- [ ] æ·»åŠ æœºå™¨å­¦ä¹ èƒ½åŠ›
- [ ] å®ç°æ™ºèƒ½è·¯ç”±å’Œè´Ÿè½½å‡è¡¡
- [ ] æ·»åŠ åˆ†å¸ƒå¼äº‹åŠ¡æ”¯æŒ

### é˜¶æ®µ4: ç”Ÿäº§åŒ–
- [ ] å®Œå–„ç›‘æ§å’Œå‘Šè­¦ç³»ç»Ÿ
- [ ] å®ç°é«˜å¯ç”¨å’Œå®¹ç¾
- [ ] æ·»åŠ å®‰å…¨è®¤è¯å’Œæˆæƒ
- [ ] æ€§èƒ½ä¼˜åŒ–å’Œè°ƒä¼˜

## ğŸ“ æ€»ç»“

å¤šAgentæ¶æ„æ”¹é€ å·²ç»æˆåŠŸå®ŒæˆåŸºç¡€æ¡†æ¶çš„å®ç°ï¼Œä¸»è¦æˆæœåŒ…æ‹¬ï¼š

1. **âœ… å®Œæ•´çš„A2Aé€šä¿¡åè®®**: æ”¯æŒå¤šç§é€šä¿¡æ¨¡å¼å’Œæ¶ˆæ¯ç±»å‹
2. **âœ… ç»Ÿä¸€çš„AgentåŸºç¡€æ¡†æ¶**: æ ‡å‡†åŒ–çš„Agentç”Ÿå‘½å‘¨æœŸå’Œæ¶ˆæ¯å¤„ç†
3. **âœ… æ™ºèƒ½çš„åè°ƒå™¨Agent**: å¤æ‚å·¥ä½œæµçš„ç¼–æ’å’Œæ‰§è¡Œ
4. **âœ… ä¸“é—¨çš„åŠŸèƒ½Agent**: NLPå’ŒSQLåˆ†æç­‰ä¸“é—¨Agent
5. **âœ… ç³»ç»Ÿç®¡ç†å’Œç›‘æ§**: å®Œæ•´çš„ç³»ç»ŸçŠ¶æ€ç›‘æ§å’Œç®¡ç†
6. **âœ… æ¼”ç¤ºå’Œæµ‹è¯•**: å¯è¿è¡Œçš„æ¼”ç¤ºè„šæœ¬éªŒè¯åŠŸèƒ½

è¿™ä¸ªå¤šAgentæ¶æ„ä¸ºç³»ç»Ÿæä¾›äº†ï¼š
- **æ›´å¥½çš„å¯æ‰©å±•æ€§**: æ”¯æŒæ°´å¹³æ‰©å±•å’ŒåŠŸèƒ½æ‰©å±•
- **æ›´é«˜çš„å¯ç»´æŠ¤æ€§**: æ¨¡å—åŒ–è®¾è®¡å’Œç‹¬ç«‹å¼€å‘
- **æ›´å¼ºçš„å¯é æ€§**: æ•…éšœéš”ç¦»å’Œè‡ªåŠ¨æ¢å¤
- **æ›´ä¼˜çš„æ€§èƒ½**: å¹¶è¡Œå¤„ç†å’Œèµ„æºä¼˜åŒ–

ç³»ç»Ÿå·²ç»å…·å¤‡äº†ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²çš„åŸºç¡€æ¶æ„ï¼Œå¯ä»¥æ ¹æ®å®é™…éœ€æ±‚è¿›è¡Œè¿›ä¸€æ­¥çš„åŠŸèƒ½æ‰©å±•å’Œæ€§èƒ½ä¼˜åŒ–ã€‚